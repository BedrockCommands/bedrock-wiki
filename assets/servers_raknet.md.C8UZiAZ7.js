import{_ as e,e as t,d as n,Q as o}from"./chunks/framework.CuLWBCQE.js";const m=JSON.parse('{"title":"RakNet Protocol","description":"RakNet protocol for Bedrock.","frontmatter":{"title":"RakNet Protocol","category":"Protocols","mentions":["ZestiiSpaghett","MedicalJewel105","SmokeyStack","ThomasOrs","theaddonn","ismaileke","Tom-Teclador","bedrock-crustaceans"],"description":"RakNet protocol for Bedrock."},"headers":[{"level":3,"title":"RakNet Notes","slug":"raknet-notes","link":"#raknet-notes","children":[]},{"level":3,"title":"Datatypes","slug":"datatypes","link":"#datatypes","children":[]},{"level":2,"title":"Contents","slug":"contents","link":"#contents","children":[{"level":3,"title":"Unconnected Pings","slug":"unconnected-pings","link":"#unconnected-pings","children":[]},{"level":3,"title":"Unconnected Pongs","slug":"unconnected-pongs","link":"#unconnected-pongs","children":[]},{"level":3,"title":"Open Connection Request 1","slug":"open-connection-request-1","link":"#open-connection-request-1","children":[]},{"level":3,"title":"Open Connection Reply 1","slug":"open-connection-reply-1","link":"#open-connection-reply-1","children":[]},{"level":3,"title":"Open Connection Request 2","slug":"open-connection-request-2","link":"#open-connection-request-2","children":[]},{"level":3,"title":"Open Connection Reply 2","slug":"open-connection-reply-2","link":"#open-connection-reply-2","children":[]},{"level":3,"title":"Connection Request","slug":"connection-request","link":"#connection-request","children":[]},{"level":3,"title":"Connection Request Accepted","slug":"connection-request-accepted","link":"#connection-request-accepted","children":[]},{"level":3,"title":"New Incoming Connection","slug":"new-incoming-connection","link":"#new-incoming-connection","children":[]},{"level":3,"title":"New Incoming Connection","slug":"new-incoming-connection-1","link":"#new-incoming-connection-1","children":[]},{"level":3,"title":"Connected Ping","slug":"connected-ping","link":"#connected-ping","children":[]},{"level":3,"title":"Connected Pong","slug":"connected-pong","link":"#connected-pong","children":[]}]},{"level":2,"title":"Implementations","slug":"implementations","link":"#implementations","children":[]},{"level":2,"title":"Sources","slug":"sources","link":"#sources","children":[]}],"relativePath":"servers/raknet.md","filePath":"servers/raknet.md"}'),r={name:"servers/raknet.md"},i=o('<p>Minecraft Bedrock uses multiple different protocols under the hood, one of them is <a href="http://www.jenkinssoftware.com/" target="_blank" rel="noreferrer">RakNet</a>. RakNet is the main protocol used for external servers, aka the server you are likely playing on... maybe it is a featured server or the server run by your friend.</p><p>One of the most important aspects is that RakNet is based on Udp. Bedrock uses the port <code>19132</code> (Ipv4, use <code>19133</code> for ipv6) as its default RakNet port for MCBE servers, you can still change the port as you wish.</p><h3 id="raknet-notes" tabindex="-1">RakNet Notes <a class="header-anchor" href="#raknet-notes" aria-label="Permalink to &quot;RakNet Notes&quot;">​</a></h3><ul><li>The offline message id will always be: <code>0x00ffff00fefefefefdfdfdfd12345678</code> - this series of bytes will be referred to as <em>Magic</em>.</li><li>The offline message id is sent with unconnected messages such as unconnected pings and pongs.</li><li>The first byte is used to identify the type of the packet.</li></ul><h3 id="datatypes" tabindex="-1">Datatypes <a class="header-anchor" href="#datatypes" aria-label="Permalink to &quot;Datatypes&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Type</th><th>Size</th><th>Range</th><th>Notes</th></tr></thead><tbody><tr><td>u8 (byte)</td><td>1</td><td>0-255</td><td>A single Byte</td></tr><tr><td>i16 (short)</td><td>2</td><td>-32768 - 32767</td><td>Signed 16-bit integer</td></tr><tr><td>u16 (unsigned short)</td><td>2</td><td>0 - 65535</td><td>Unsigned 16-bit integer</td></tr><tr><td>u24 (unsigned int24)</td><td>3</td><td>0 - 2^24-1</td><td>Unsigned 21-bit integer</td></tr><tr><td>i64 (long)</td><td>8</td><td>-2^63 to 2^63-1</td><td>Signed 64-bit integer</td></tr><tr><td>bool (boolean)</td><td>1</td><td>0 - 1</td><td><code>0</code> is <code>false</code>, while <code>1</code> is <code>true</code></td></tr><tr><td>String</td><td>N/A</td><td></td><td>A String prefixed by an u16 (encoded as Big Endian), which depicts the length</td></tr><tr><td>Guid</td><td>8</td><td></td><td>A Globally Unique Identifier that is stored as an i64</td></tr><tr><td>Socket Address</td><td>7</td><td></td><td>1 byte for the ip version 4/6, 4 for the IP and 2 for the port</td></tr><tr><td>Magic</td><td>16</td><td></td><td>Special constant byte sequence <code>0x00ffff00fefefefefdfdfdfd12345678</code></td></tr></tbody></table><h2 id="contents" tabindex="-1">Contents <a class="header-anchor" href="#contents" aria-label="Permalink to &quot;Contents&quot;">​</a></h2><ul><li><a href="#unconnected-pings">Unconnected Pings</a></li><li><a href="#unconnected-pongs">Unconnected Pongs</a></li><li><a href="#open-connection-request-1">Open Connection Request 1</a></li><li><a href="#open-connection-reply-1">Open Connection Reply 1</a></li><li><a href="#open-connection-request-2">Open Connection Request 2</a></li><li><a href="#open-connection-reply-2">Open Connection Reply 2</a> (From here on, the RakNet connection is established, and all RakNet messages are contained in a <a href="https://wiki.vg/Raknet_Protocol#Frame_Set_Packet" target="_blank" rel="noreferrer">Frame Set Packet</a>)</li><li><a href="#connection-request">Connection Request</a></li><li><a href="#connection-request-accepted">Connection Request Accepted</a></li><li><a href="#new-incoming-connection">New Incoming Connection</a></li></ul><h3 id="unconnected-pings" tabindex="-1">Unconnected Pings <a class="header-anchor" href="#unconnected-pings" aria-label="Permalink to &quot;Unconnected Pings&quot;">​</a></h3><p>Minecraft Bedrock will send out a message to all listed servers (and the local network) to check if any games are available and retrieve the MOTD from the game. These messages are known as unconnected pings and are structured in this format:</p><p><code>0x01 | client alive time in ms (unsigned long long) | magic | client GUID</code></p><h3 id="unconnected-pongs" tabindex="-1">Unconnected Pongs <a class="header-anchor" href="#unconnected-pongs" aria-label="Permalink to &quot;Unconnected Pongs&quot;">​</a></h3><p>After this message, the server will respond with something called an unconnected pong. The reason these messages are unconnected is that the client has not established a connection to the server. This is the format of an unconnected pong:</p><p><code>0x1c | client alive time in ms (recorded from previous ping) | server GUID | Magic | string length | Edition (MCPE or MCEE for Education Edition);MOTD line 1;Protocol Version;Version Name;Player Count;Max Player Count;Server Unique ID;MOTD line 2;Game mode;Game mode (numeric);Port (IPv4);Port (IPv6);</code></p><p>Example:</p><p><code>MCPE;Dedicated Server;527;1.19.1;0;10;13253860892328930865;Bedrock level;Survival;1;19132;19133;</code></p><p>The client doesn&#39;t seem to use the gamemode or the numeric value for the gamemode.</p><h3 id="open-connection-request-1" tabindex="-1">Open Connection Request 1 <a class="header-anchor" href="#open-connection-request-1" aria-label="Permalink to &quot;Open Connection Request 1&quot;">​</a></h3><p>(Client -&gt; Server)</p><p>The client sends this when attempting to join the server</p><p><code>0x05 | Magic | Protocol version (currently 11 or 0x0b) | RakNet Null Padding</code></p><p>The null padding seems to be used to discover the maximum packet size the network can handle.</p><p>The client will send this to the server with decreasing null padding, until the server responds with a <a href="#open-connection-reply-1">Open Connection Reply 1</a></p><h3 id="open-connection-reply-1" tabindex="-1">Open Connection Reply 1 <a class="header-anchor" href="#open-connection-reply-1" aria-label="Permalink to &quot;Open Connection Reply 1&quot;">​</a></h3><p>(Server -&gt; Client)</p><p>The server responds with this once the client attempts to join</p><p><code>0x06 | magic | server GUID | ServerHasSecurity (boolean) | Cookie (uint32, if server has security) | MTU Size (Unsigned short)</code></p><p>This is the first half of the handshake between the client and the server.</p><h3 id="open-connection-request-2" tabindex="-1">Open Connection Request 2 <a class="header-anchor" href="#open-connection-request-2" aria-label="Permalink to &quot;Open Connection Request 2&quot;">​</a></h3><p>(Client -&gt; Server)</p><p>The client responds with this after they receive the open connection reply 1 packet.</p><p><code>0x07 | magic | Cookie (uint32, if server has security) | Client supports security (Boolean(false), always false for the vanilla client, if server has security) | server Address | MTU Size (Unsigned short) | client GUID (Long)</code></p><h3 id="open-connection-reply-2" tabindex="-1">Open Connection Reply 2 <a class="header-anchor" href="#open-connection-reply-2" aria-label="Permalink to &quot;Open Connection Reply 2&quot;">​</a></h3><p>(Server -&gt; Client)</p><p>This is the last part of the handshake between the client and the server.</p><p><code>0x08 | magic | server GUID (Long) | client Address | MTU Size | security(Boolean)</code></p><p><strong>From here on, all RakNet messages are contained in a <a href="https://wiki.vg/Raknet_Protocol#Frame_Set_Packet" target="_blank" rel="noreferrer">Frame Set Packet</a>.</strong></p><h3 id="connection-request" tabindex="-1">Connection Request <a class="header-anchor" href="#connection-request" aria-label="Permalink to &quot;Connection Request&quot;">​</a></h3><p>(Client -&gt; Server)</p><p>This is the part where the client sends the connection request.</p><p><code>0x09 | client GUID (Long) | Request timestamp (Long) | Secure (Boolean)</code></p><h3 id="connection-request-accepted" tabindex="-1">Connection Request Accepted <a class="header-anchor" href="#connection-request-accepted" aria-label="Permalink to &quot;Connection Request Accepted&quot;">​</a></h3><p>(Server -&gt; Client)</p><p>The server sends this packet in response to the incoming connection request.</p><p><code>0x10 | client Address | System index (Short, unknown what this does. 0 works as a value (Minecraft client sends 47)) | System adresses ([]Address) | Ping time (Long) | Pong Time (Long)</code></p><h3 id="new-incoming-connection" tabindex="-1">New Incoming Connection <a class="header-anchor" href="#new-incoming-connection" aria-label="Permalink to &quot;New Incoming Connection&quot;">​</a></h3><p>(Client -&gt; Server)</p><p>Our RakNet connection is now fully successful.</p><p><code>0x13 | server Address | internal Adress ([20(maybe 10)]Address) (i use 255.255.255.255:0) | Ping time (Long) | Pong Time (Long)</code></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The next two packets (and the first Minecraft Protocol packet) are all sent together as one by the vanilla client. The RakNetProtocol allows for them to be sent separately too, however, servers with a custom raknet implementation might not always handle this case because this never occurs within the vanilla client.</p></div><h3 id="new-incoming-connection-1" tabindex="-1">New Incoming Connection <a class="header-anchor" href="#new-incoming-connection-1" aria-label="Permalink to &quot;New Incoming Connection&quot;">​</a></h3><p>The client sends this packet in response to Connection Request Accepted.</p><p><code>0x13 | serverAddress (uint8) | clientMachineAddresses (address[10], Minecraft sends only one ipv6 together with a placeholder (see below) instead of the other 9) | clientSendTime (uint64) | serverSendTime (uint64)</code></p><p>placeholder for the other clientMachineAddresses (a.k.a. Internal Addresses):</p><blockquote><p><code>0xd4 0x0b 0xa7 0x86 0xdd 0x98 0x33 0x00 0x00</code> each byte replaces one of the 9 missing clientMachineAddresses</p></blockquote><p>After having sent this packet, you must periodically send a Connected Ping to keep the connection alive. The server also sometimes sends a Connected Ping, respond with a Connected Pong.</p><h3 id="connected-ping" tabindex="-1">Connected Ping <a class="header-anchor" href="#connected-ping" aria-label="Permalink to &quot;Connected Ping&quot;">​</a></h3><p>The client sends this packet immediately after/with New Incoming Connection. This packet should be sent as unreliable. The client/server will respond to this with a Connected Pong.</p><p><code>0x00 | Time since start (uint64)</code></p><h3 id="connected-pong" tabindex="-1">Connected Pong <a class="header-anchor" href="#connected-pong" aria-label="Permalink to &quot;Connected Pong&quot;">​</a></h3><p>The client or server sends this packet after having received a Connected Ping. This packet should be sent as unreliable.</p><p><code>0x00 | Time since start client (uint64) | Time since start server (uint64)</code></p><h2 id="implementations" tabindex="-1">Implementations <a class="header-anchor" href="#implementations" aria-label="Permalink to &quot;Implementations&quot;">​</a></h2><p>Not everything can be explained in great detail via documentation, that&#39;s why looking at existing implementations is very helpful. Here is list of RakNet Protocol implementations</p><table tabindex="0"><thead><tr><th>Name</th><th>Description</th><th>Language</th></tr></thead><tbody><tr><td><a href="https://github.com/facebookarchive/RakNet" target="_blank" rel="noreferrer">RakNet (Official)</a></td><td>RakNet is a cross platform, open source, C++ networking engine for game programmers</td><td>C++</td></tr><tr><td><a href="https://github.com/bedrock-crustaceans/raknet" target="_blank" rel="noreferrer">bedrock-crustaceans/raknet</a></td><td>RakNet implementation in Rust</td><td>Rust</td></tr><tr><td><a href="https://github.com/NetrexMC/RakNet" target="_blank" rel="noreferrer">NetrexMC/RakNet</a></td><td>RakNet implementation in Rust</td><td>Rust</td></tr><tr><td><a href="https://github.com/b23r0/rust-raknet" target="_blank" rel="noreferrer">rust-raknet</a></td><td>RakNet Protocol implementation by Rust</td><td>Rust</td></tr><tr><td><a href="https://github.com/CloudburstMC/Network/tree/develop/transport-raknet" target="_blank" rel="noreferrer">transport-raknet</a></td><td>netty-transport-raknet</td><td>Java</td></tr><tr><td><a href="https://github.com/pmmp/RakLib" target="_blank" rel="noreferrer">RakLib</a></td><td>RakNet server implementation written in PHP</td><td>PHP</td></tr><tr><td><a href="https://github.com/Sandertv/go-raknet" target="_blank" rel="noreferrer">go-raknet</a></td><td>Go library implementing a basic version of the RakNet protocol</td><td>Go</td></tr><tr><td><a href="https://github.com/raknet-python/raknet-python" target="_blank" rel="noreferrer">raknet-python</a></td><td>Python bindings for RakNet, a cross-platform networking engine for game programmers</td><td>Python</td></tr><tr><td><a href="https://github.com/PieMC-Dev/PieRakNet" target="_blank" rel="noreferrer">PieRakNet</a></td><td>RakNet implementation, written in Python. Created for PieMC</td><td>Python</td></tr><tr><td><a href="https://github.com/JSPrismarine/JSPrismarine/tree/master/packages/raknet" target="_blank" rel="noreferrer">JSPrismarine/raknet</a></td><td></td><td>Javascript, Typescript</td></tr></tbody></table><h2 id="sources" tabindex="-1">Sources <a class="header-anchor" href="#sources" aria-label="Permalink to &quot;Sources&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you are interested and want to read more about RakNet here is the documentation for the Bedrock Protocol and RakNet:</p><p><a href="https://wiki.vg/Raknet_Protocol" target="_blank" rel="noreferrer">RakNet Protocol Documentation</a><a href="https://github.com/vp817/RakNetProtocolDoc" target="_blank" rel="noreferrer">Other RakNet Protocol Documentation</a></p></div><p>This page is a WIP, feel free to contribute as it is still being worked on.</p>',68),a=[i];function s(c,d,l,h,p,u){return n(),t("div",null,a)}const k=e(r,[["render",s]]);export{m as __pageData,k as default};
